'use strict';var GM_wrench=GM_wrench||{};
(()=>{function z(a){return a?`${"function"===typeof a?a():a}\n`:""}function A(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a}function d(a,b){this.using=a;this.value=b}function q(a,b){this.message=a;this.fn=b}function u(a,b){q.call(this,a,b)}function v(a){this.then=a.then.bind(a);this.catch=a.catch.bind(a)}function k(a){a=Reflect.construct(Error,[a]);Reflect.setPrototypeOf(a,Reflect.getPrototypeOf(this));return a}function w(a){if(a instanceof d||"function"===typeof a)return a;
if("string"===typeof a)return d.css(a);if(a&&"object"===typeof a&&"string"===typeof a.using&&"string"===typeof a.value)return new d(a.using,a.value);for(let b in a)if(Object.prototype.hasOwnProperty.call(a,b)&&Object.prototype.hasOwnProperty.call(d,b))return d[b](a[b]);throw new TypeError("Invalid locator");}async function B(a,b=document){a=w(a);"function"===typeof a?(a=await a(b),a=a instanceof Element?[a]:Array.isArray(a)?a.filter(function(c){return c instanceof Element}):[]):a=await C.findElements(b,
a.using,a.value);return a}GM_wrench.sleep=function(a){return new Promise(b=>setTimeout(()=>b(),a))};GM_wrench.addCss=function(a){var b=document.createElement("style");b.type="text/css";b.styleSheet?b.styleSheet.cssText=a:b.appendChild(document.createTextNode(a));document.getElementsByTagName("head")[0].appendChild(b)};GM_wrench.addStylesheet=function(a){var b=document.createElement("link");b.rel="stylesheet";b.href=a;document.getElementsByTagName("head")[0].appendChild(b)};GM_wrench.waitForKeyElements=
function(a,b,c,e,g){"undefined"===typeof c&&(c=!0);"undefined"===typeof e&&(e=300);"undefined"===typeof g&&(g=-1);var t="function"===typeof a?a():document.querySelectorAll(a),l=t&&0<t.length;l&&t.forEach(function(p){p.getAttribute("data-userscript-alreadyFound")||(b(p)?l=!1:p.setAttribute("data-userscript-alreadyFound",!0))});0===g||l&&c||(--g,setTimeout(function(){GM_wrench.waitForKeyElements(a,b,c,e,g)},e))};GM_wrench.wait=function({condition:a,input:b,timeout:c=0,pollTimeout:e=200,message:g}={}){function t(){return new Promise((f,
m)=>{try{f(p(b))}catch(r){m(r)}})}if("number"!==typeof c||0>c)throw new TypeError("timeout must be a number >= 0: "+c);if("number"!==typeof e||0>e)throw new TypeError("pollTimeout must be a number >= 0: "+e);try{var l=a&&("object"===typeof a||"function"===typeof a)&&"function"===typeof a.then}catch(f){l=!1}if(l)return new Promise((f,m)=>{if(c){var r=Date.now(),n=setTimeout(function(){n=null;try{let h=z(g);m(new k(`${h}Timed out waiting for promise to resolve after ${Date.now()-r}ms`))}catch(h){m(new k(`${h.message}\nTimed out waiting for promise to resolve after ${Date.now()-
r}ms`))}},c);a.then(function(h){n&&clearTimeout(n);f(h)},function(h){n&&clearTimeout(n);m(h)})}else f(a)});let p;if(a instanceof q)g=g||a.description(),p=a.fn;else if("function"===typeof a)p=a;else throw new TypeError("Wait condition must be a promise-like object, function, or a Condition object");l=new Promise((f,m)=>{const r=Date.now(),n=async()=>{t().then(function(h){const x=Date.now()-r;if(h)f(h);else if(c&&x>=c)try{let y=z(g);m(new k(`${y}Wait timed out after ${x}ms`))}catch(y){m(new k(`${y.message}\nWait timed out after ${x}ms`))}else setTimeout(n,
e)},m)};n()});return a instanceof u?new v(l.then(function(f){if(!(f instanceof Element))throw new TypeError("ElementCondition did not resolve to a Element: "+Object.prototype.toString.call(f));return f})):l};d.prototype.toString=function(){return`By(${this.using}, ${this.value})`};GM_wrench.By=d;d.css=function(a){return new d("css",a)};d.id=function(a){return new d("id",a)};d.className=function(a){return new d("className",a)};d.linkText=function(a){return new d("linkText",a)};GM_wrench.Condition=
q;q.prototype.description=function(){return"Waiting "+this.message};A(u,q);GM_wrench.ElementCondition=u;A(v,Element);GM_wrench.ElementPromise=v;k.prototype=Object.create(Error.prototype,{constructor:{value:Error,enumerable:!1,writeable:!0,configurable:!0}});Reflect.setPrototypeOf(k,Error);k.prototype.name="TimeoutError";k.prototype.stack="";GM_wrench.TimeoutError=k;const C={findElements:async function(a,b,c){switch(b){case "css":return a.querySelectorAll(c);case "id":return a.querySelectorAll(`*[id="${c}"]`);
case "className":return a.querySelectorAll(`."${c}"`);case "linkText":return[...a.querySelectorAll("a")].filter(e=>e.innerText===c);default:throw new TypeError("Unrecognized locator type: "+b);}}};GM_wrench.until={};GM_wrench.until.elementLocated=function(a){a=w(a);return new u("for element to be located "+("function"===typeof a?"by function()":a+""),async function(b){return(await B(a,b))[0]})};GM_wrench.until.elementsLocated=function(a){a=w(a);return new q("for at least one element to be located "+
("function"===typeof a?"by function()":a+""),async function(b){b=await B(a,b);return 0<b.length?b:null})}})();
