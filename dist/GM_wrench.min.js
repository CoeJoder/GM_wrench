var GM_wrench=GM_wrench||{};
(()=>{function z(a){return a?`${"function"===typeof a?a():a}\n`:""}function A(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a}function h(a,b){this.using=a;this.value=b}function u(a,b){this.message=a;this.fn=b}function w(a,b){u.call(this,a,b)}function x(a){this.then=a.then.bind(a);this.catch=a.catch.bind(a)}function p(a){a=Reflect.construct(Error,[a]);Reflect.setPrototypeOf(a,Reflect.getPrototypeOf(this));return a}function y(a){if(a instanceof h||"function"===typeof a)return a;
if("string"===typeof a)return h.css(a);if(a&&"object"===typeof a&&"string"===typeof a.using&&"string"===typeof a.value)return new h(a.using,a.value);for(let b in a)if(Object.prototype.hasOwnProperty.call(a,b)&&Object.prototype.hasOwnProperty.call(h,b))return h[b](a[b]);throw new TypeError("Invalid locator");}async function B(a,b=document){a=y(a);"function"===typeof a?(a=await a(b),a=a instanceof Element?[a]:Array.isArray(a)?a.filter(function(c){return c instanceof Element}):[]):a=await D.findElements(b,
a.using,a.value);return a}(()=>{const a=[];let b=!1;const c={trace:10,debug:20,info:30,warn:40,error:50,fatal:60};var f;let l,t,n;const q={level:"info",prefix:null!=(n=null==(f=GM)?void 0:null==(l=f.info)?void 0:null==(t=l.script)?void 0:t.name)?n:null,registerMenu:!0,menuLabels:["trace","debug","info"],formatter:(d,k,g)=>`${null!==g?`[${g}] `:""}${null!==k?`[${k.toUpperCase()}] `:""}${d}`},m=d=>{if(!Array.isArray(d))throw Error("Expected 'labels' to be array");const k=[];d.forEach(g=>{if(!(g in c))throw Error(`Invalid menu label: ${g}. Expected one of: ${Object.keys(c).join(", ")}`);
k.push(g)});return k};f=function({}={}){let d,k;Object.defineProperty(this,"level",{get:()=>d,set:e=>{if(!(e in c))throw Error(`Invalid log level: ${e}. Expected one of: ${Object.keys(c).join(", ")}`);d=e}});Object.defineProperty(this,"formatter",{get:()=>k,set:e=>{if("function"!==typeof e)throw Error("Invalid formatter. Expected a function");k=e}});const g=Object.assign({},q,arguments[0]);this.level=g.level;this.formatter=g.formatter;this.prefix=g.prefix;this._check=function(e){return c[e]>=c[this.level]};
this._msgToString=function(e,r){return this.formatter(e,r,this.prefix)};if(g.registerMenu&&(a.push(this),!b)){let e;if("undefined"===typeof(null==(e=GM)?void 0:e.registerMenuCommand))throw Error("This userscript must @grant GM.registerMenuCommand");m(g.menuLabels).forEach(r=>{let v;null==(v=GM)||v.registerMenuCommand(r,()=>{a.forEach(C=>{console.log(C._msgToString(`Setting log level to: ${r.toUpperCase()}`,null));C.level=r})})});b=!0}};f.prototype.trace=function(d){this._check("trace")&&console.log(this._msgToString(d,
"trace"))};f.prototype.debug=function(d){this._check("debug")&&console.log(this._msgToString(d,"debug"))};f.prototype.info=function(d){this._check("info")&&console.log(this._msgToString(d,"info"))};f.prototype.warn=function(d){this._check("warn")&&console.warn(this._msgToString(d,"warn"))};f.prototype.error=function(d){this._check("error")&&console.error(this._msgToString(d,"error"))};f.prototype.fatal=function(d){this._check("fatal")&&console.error(this._msgToString(d,"fatal"))};GM_wrench.Logger=
f})();GM_wrench.sleep=function(a){return new Promise(b=>setTimeout(()=>b(),a))};GM_wrench.addCss=function(a){var b=document.createElement("style");b.type="text/css";b.styleSheet?b.styleSheet.cssText=a:b.appendChild(document.createTextNode(a));document.getElementsByTagName("head")[0].appendChild(b)};GM_wrench.addStylesheet=function(a){var b=document.createElement("link");b.rel="stylesheet";b.href=a;document.getElementsByTagName("head")[0].appendChild(b)};GM_wrench.isCssSelectorSupported=function(a){const b=
document.createElement("style");document.head.appendChild(b);try{let c;null==(c=b.sheet)||c.insertRule(a+"{}",0)}catch(c){return!1}finally{document.head.removeChild(b)}return!0};GM_wrench.waitForKeyElements=function(a,b,c,f,l){"undefined"===typeof c&&(c=!0);"undefined"===typeof f&&(f=300);"undefined"===typeof l&&(l=-1);var t="function"===typeof a?a():document.querySelectorAll(a),n=t&&0<t.length;n&&t.forEach(function(q){q.getAttribute("data-userscript-alreadyFound")||(b(q)?n=!1:q.setAttribute("data-userscript-alreadyFound",
!0))});0===l||n&&c||(--l,setTimeout(function(){GM_wrench.waitForKeyElements(a,b,c,f,l)},f))};GM_wrench.wait=function({condition:a,input:b,timeout:c=0,pollTimeout:f=200,message:l}={}){function t(){return new Promise((m,d)=>{try{m(q(b))}catch(k){d(k)}})}if("number"!==typeof c||0>c)throw new TypeError("timeout must be a number >= 0: "+c);if("number"!==typeof f||0>f)throw new TypeError("pollTimeout must be a number >= 0: "+f);try{var n=a&&("object"===typeof a||"function"===typeof a)&&"function"===typeof a.then}catch(m){n=
!1}if(n)return new Promise((m,d)=>{if(c){var k=Date.now(),g=setTimeout(function(){g=null;try{let e=z(l);d(new p(`${e}Timed out waiting for promise to resolve after ${Date.now()-k}ms`))}catch(e){d(new p(`${e.message}\nTimed out waiting for promise to resolve after ${Date.now()-k}ms`))}},c);a.then(function(e){g&&clearTimeout(g);m(e)},function(e){g&&clearTimeout(g);d(e)})}else m(a)});let q;if(a instanceof u)l=l||a.description(),q=a.fn;else if("function"===typeof a)q=a;else throw new TypeError("Wait condition must be a promise-like object, function, or a Condition object");
n=new Promise((m,d)=>{const k=Date.now(),g=async()=>{t().then(function(e){const r=Date.now()-k;if(e)m(e);else if(c&&r>=c)try{let v=z(l);d(new p(`${v}Wait timed out after ${r}ms`))}catch(v){d(new p(`${v.message}\nWait timed out after ${r}ms`))}else setTimeout(g,f)},d)};g()});return a instanceof w?new x(n.then(function(m){if(!(m instanceof Element))throw new TypeError("ElementCondition did not resolve to a Element: "+Object.prototype.toString.call(m));return m})):n};h.prototype.toString=function(){return`By(${this.using}, ${this.value})`};
GM_wrench.By=h;h.css=function(a){return new h("css",a)};h.id=function(a){return new h("id",a)};h.className=function(a){return new h("className",a)};h.linkText=function(a){return new h("linkText",a)};GM_wrench.Condition=u;u.prototype.description=function(){return"Waiting "+this.message};A(w,u);GM_wrench.ElementCondition=w;A(x,Element);GM_wrench.ElementPromise=x;p.prototype=Object.create(Error.prototype,{constructor:{value:Error,enumerable:!1,writeable:!0,configurable:!0}});Reflect.setPrototypeOf(p,
Error);p.prototype.name="TimeoutError";p.prototype.stack="";GM_wrench.TimeoutError=p;const D={findElements:async function(a,b,c){switch(b){case "css":return a.querySelectorAll(c);case "id":return a.querySelectorAll(`*[id="${c}"]`);case "className":return a.querySelectorAll(`."${c}"`);case "linkText":return[...a.querySelectorAll("a")].filter(f=>f.innerText===c);default:throw new TypeError("Unrecognized locator type: "+b);}}};GM_wrench.until={};GM_wrench.until.elementLocated=function(a){a=y(a);return new w("for element to be located "+
("function"===typeof a?"by function()":a+""),async function(b){return(await B(a,b))[0]})};GM_wrench.until.elementsLocated=function(a){a=y(a);return new u("for at least one element to be located "+("function"===typeof a?"by function()":a+""),async function(b){b=await B(a,b);return 0<b.length?b:null})}})();
