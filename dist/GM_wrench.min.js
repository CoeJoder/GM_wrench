'use strict';var GM_wrench=GM_wrench||{};
(()=>{function A(a){return a?`${"function"===typeof a?a():a}\n`:""}function B(a,b=0,d=200,c){this.input=a;this.timeout=b;this.pollTimeout=d;this.message=c}function v(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a}function e(a,b){this.using=a;this.value=b}function r(a,b){this.message=a;this.fn=b}function u(a,b){r.call(this,a,b)}function w(a){this.then=a.then.bind(a);this.catch=a.catch.bind(a)}function m(a){Error.call(this,a);this.message=a}function x(a){if(a instanceof e||"function"===
typeof a)return a;if("string"===typeof a)return e.css(a);if(a&&"object"===typeof a&&"string"===typeof a.using&&"string"===typeof a.value)return new e(a.using,a.value);for(let b in a)if(Object.prototype.hasOwnProperty.call(a,b)&&Object.prototype.hasOwnProperty.call(e,b))return e[b](a[b]);throw new TypeError("Invalid locator");}async function C(a,b=document){a=x(a);"function"===typeof a?(a=await a(b),a=a instanceof Element?[a]:Array.isArray(a)?a.filter(function(d){return d instanceof Element}):[]):
a=await D.findElements(b,a.using,a.value);return a}GM_wrench.sleep=function(a){return new Promise(b=>setTimeout(()=>b(),a))};GM_wrench.addCss=function(a){var b=document.createElement("style");b.type="text/css";b.styleSheet?b.styleSheet.cssText=a:b.appendChild(document.createTextNode(a));document.getElementsByTagName("head")[0].appendChild(b)};GM_wrench.addStylesheet=function(a){var b=document.createElement("link");b.rel="stylesheet";b.href=a;document.getElementsByTagName("head")[0].appendChild(b)};
GM_wrench.waitForKeyElements=function(a,b,d,c,g){"undefined"===typeof d&&(d=!0);"undefined"===typeof c&&(c=300);"undefined"===typeof g&&(g=-1);var n="function"===typeof a?a():document.querySelectorAll(a),k=n&&0<n.length;k&&n.forEach(function(p){p.getAttribute("data-userscript-alreadyFound")||(b(p)?k=!1:p.setAttribute("data-userscript-alreadyFound",!0))});0===g||k&&d||(--g,setTimeout(function(){GM_wrench.waitForKeyElements(a,b,d,c,g)},c))};GM_wrench.Waiter=B;B.prototype.wait=function(a){function b(){return new Promise((f,
l)=>{try{f(p(d))}catch(t){l(t)}})}let d=this.input,c=this.timeout,g=this.message,n=this.pollTimeout;if("number"!==typeof c||0>c)throw TypeError("timeout must be a number >= 0: "+c);if("number"!==typeof n||0>n)throw TypeError("pollTimeout must be a number >= 0: "+n);try{var k=a&&("object"===typeof a||"function"===typeof a)&&"function"===typeof a.then}catch(f){k=!1}if(k)return new Promise((f,l)=>{if(c){var t=Date.now(),q=setTimeout(function(){q=null;try{let h=A(g);l(new m(`${h}Timed out waiting for promise to resolve after ${Date.now()-
t}ms`))}catch(h){l(new m(`${h.message}\nTimed out waiting for promise to resolve after ${Date.now()-t}ms`))}},c);a.then(function(h){q&&clearTimeout(q);f(h)},function(h){q&&clearTimeout(q);l(h)})}else f(a)});let p;if(a instanceof r)g=g||a.description(),p=a.fn;else if("function"===typeof p)p=a;else throw TypeError("Wait condition must be a promise-like object, function, or a Condition object");k=new Promise((f,l)=>{const t=Date.now(),q=async()=>{b().then(function(h){const y=Date.now()-t;if(h)f(h);else if(c&&
y>=c)try{let z=A(g);l(new m(`${z}Wait timed out after ${y}ms`))}catch(z){l(new m(`${z.message}\nWait timed out after ${y}ms`))}else setTimeout(q,n)},l)};q()});return a instanceof u?new w(k.then(function(f){if(!(f instanceof Element))throw TypeError("ElementCondition did not resolve to a Element: "+Object.prototype.toString.call(f));return f})):k};e.prototype.toString=function(){return`By(${this.using}, ${this.value})`};GM_wrench.By=e;e.css=function(a){return new e("css",a)};e.id=function(a){return new e("id",
a)};e.className=function(a){return new e("className",a)};e.linkText=function(a){return new e("linkText",a)};GM_wrench.Condition=r;r.prototype.description=function(){return"Waiting "+this.message};v(u,r);GM_wrench.ElementCondition=u;v(w,Element);GM_wrench.ElementPromise=w;v(m,Error);m.prototype.name=m.name;GM_wrench.TimeoutError=m;const D={findElements:async function(a,b,d){switch(b){case "css":return a.querySelectorAll(d);case "id":return a.querySelectorAll(`*[id="${d}"]`);case "className":return a.querySelectorAll(`."${d}"`);
case "linkText":return[...a.querySelectorAll("a")].filter(c=>c.innerText===d);default:throw new TypeError("Unrecognized locator type: "+b);}}};GM_wrench.until={};GM_wrench.until.elementLocated=function(a){a=x(a);return new u("for element to be located "+("function"===typeof a?"by function()":a+""),async function(b){return(await C(a,b))[0]})};GM_wrench.until.elementsLocated=function(a){a=x(a);return new r("for at least one element to be located "+("function"===typeof a?"by function()":a+""),async function(b){b=
await C(a,b);return 0<b.length?b:null})}})();
